<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<TITLE></TITLE>
<META NAME="generator" CONTENT="HTML::TextToHTML v2.45">
</HEAD>
<BODY>
<P><STRONG><FONT COLOR="NAVY">PROBLEM DESCRIPTION</FONT></STRONG>

<P>In alsa-lib-1.0.14 final version, all of the floating point formats were
disabled.  Because discord uses doubles for internal processing and
passes doubles to alsa-lib for conversion to the sound card's native
internal format, it cannot work with alsa-lib-1.0.14.  The latest
development version of alsa-lib fixes this problem.  Here is a step by
step description of how to install the latest version of alsa-lib
without breaking your package management system's automatic update
capability.

<P>NOTE:  Some parts of these instruction require that you become the
superuser, root.  You can, of course, follow the directions in the
INSTALL file from alsa-lib to create a static library and link against
it without being root.  I won't be covering that option here, though.

<P>I have put the commands on a line by themselves to avoid delimiters.

<P><STRONG><FONT COLOR="NAVY">WORKAROUND PROCESS</FONT></STRONG>

<OL>
  <LI>Go to <A HREF="ftp://ftp.suse.com/pub/projects/alsa/snapshot/lib/">ftp://ftp.suse.com/pub/projects/alsa/snapshot/lib/</A> and
download the file alsa-lib-hg20070714.tar.bz2.  This is the version I
tested with, so I know it works.  If you feel adventurous, you can try
the latest file.  Right now, alsa-lib-hg20070714.tar.bz2 is the latest file.
  <LI>Run the command <BR>
<STRONG><FONT COLOR=MAROON>tar -jxvf alsa-lib-hg20070714.tar.bz2</FONT></STRONG>   <BR>
This will create a directory named alsa-lib-hg20070714.  
  <LI>Go into the directory.   <BR>
<STRONG><FONT COLOR=MAROON>cd alsa-lib-hg20070714</FONT></STRONG>
  <LI>Type command <BR>
<STRONG><FONT COLOR=MAROON>./configure</FONT></STRONG>
  <LI>Type command <BR>
<STRONG><FONT COLOR=MAROON>make</FONT></STRONG> <BR>
If make fails with python errors, check that there is a directory python
under /usr/include.  If there is only a directory like python2.5, as on
Fedora 7, make a symbolic link so the make file can find the python
headers.  You will need to be root to do this. <BR>
<STRONG><FONT COLOR=MAROON>cd /usr/include</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>ls -d python*</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>ln -s python2.5 python</FONT></STRONG>
  <LI>From this point on you have to be root as you are altering system
files.  As root, go into the directory alsa-lib-hg20070714/src/.libs/.
Copy the file libasound.so.2.0.0 to /usr/local/lib.   <BR>
<STRONG><FONT COLOR=MAROON>cd src/.libs</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>cp libasound.so.2.0.0 /usr/local/lib/</FONT></STRONG>
  <LI>Change to the /usr/local/lib directory. <BR>
<STRONG><FONT COLOR=MAROON>cd /usr/local/lib</FONT></STRONG>
<LI>Make a new alsa subdirectory.  This is necessary to avoid activating
other libraries in /usr/local/lib. <BR>
<STRONG><FONT COLOR=MAROON>mkdir alsa</FONT></STRONG>
<LI>Move the new library there. <BR>
<STRONG><FONT COLOR=MAROON>mv libasound.so.2.0.0 alsa/</FONT></STRONG>
<LI>Change to the alsa directory <BR>
<STRONG><FONT COLOR=MAROON>cd alsa</FONT></STRONG>
  <LI>Check that the library is there. <BR>
<STRONG><FONT COLOR=MAROON>ls -l libasound*</FONT></STRONG> <BR>
-rwxr-xr-x 1 root root 2786874 2007-08-06 08:24 libasound.so.2.0.0
  <LI>Create a new symbolic link to the shared library you just moved. <BR>
<STRONG><FONT COLOR=MAROON>ln -s libasound.so.2.0.0 libasound.so.2</FONT></STRONG>
  <LI>Check that the link is there. <BR>
<STRONG><FONT COLOR=MAROON>ls -l libasound*</FONT></STRONG> <BR>
lrwxrwxrwx 1 root root      18 2007-08-06 08:28 libasound.so.2 -&gt; libasound.so.2.0.0 <BR>
-rwxr-xr-x 1 root root 2786874 2007-08-06 08:24 libasound.so.2.0.0
  <LI>Change to the /usr/lib directory. <BR>
<STRONG><FONT COLOR=MAROON>cd /usr/lib</FONT></STRONG>
  <LI>Find the setup for the libasound library. <BR>
<STRONG><FONT COLOR=MAROON>ls -l libasound*</FONT></STRONG> <BR>
-rw-r--r-- 1 root root 1458654 2007-08-01 01:45 libasound.a <BR>
lrwxrwxrwx 1 root root      29 2007-08-06 08:31 libasound.so -&gt; /lib/libasound.so.2
  <LI>Remove the current link to the package library in /lib. <BR>
<STRONG><FONT COLOR=MAROON>rm libasound.so</FONT></STRONG>
  <LI>Check that it is gone. <BR>
<STRONG><FONT COLOR=MAROON>ls -l libasound*</FONT></STRONG> <BR>
-rw-r--r-- 1 root root 1458654 2007-08-01 01:45 libasound.a
  <LI>Create a new symbolic link here to the symbolic link you created in /usr/local/lib/alsa. <BR>
<STRONG><FONT COLOR=MAROON>ln -s /usr/local/lib/alsa/libasound.so.2 libasound.so</FONT></STRONG>
  <LI>Check that the link was created. <BR>
<STRONG><FONT COLOR=MAROON>ls -l libasound*</FONT></STRONG> <BR>
-rw-r--r-- 1 root root 1458654 2007-08-01 01:45 libasound.a <BR>
lrwxrwxrwx 1 root root      29 2007-08-06 08:31 libasound.so -&gt; /usr/local/lib/alsa/libasound.so.2
  <LI>Change to the /etc/ld.so.conf.d directory. <BR>
<STRONG><FONT COLOR=MAROON>cd /etc/ld.so.conf.d</FONT></STRONG>
  <LI>Use a text editor to create a file called alsa.conf.  I use vim with the
following commands. <BR>
<STRONG><FONT COLOR=MAROON>vim alsa.conf</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>i to put it into insert mode</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>Type  /usr/local/lib/alsa</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>Hit the escape key to get back to command mode</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>Type  :wq</FONT></STRONG> <BR>
If you get in trouble with vim's modes, hit escape a few times, then type :q to quit.
  <LI>Check that the file is there and has /usr/local/lib/alsa in it. <BR>
<STRONG><FONT COLOR=MAROON>less alsa.conf</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>Type a q to exit less.</FONT></STRONG>
  <LI>Run the ldconfig command to recreate the dynamic library cache in order
to pick up the new libasound we have just configured. <BR>
<STRONG><FONT COLOR=MAROON>/sbin/ldconfig</FONT></STRONG>
  <LI>From here on you do not have to be the superuser, root.  Change to
your discord directory and recompile. <BR>
<STRONG><FONT COLOR=MAROON>cd &lt;your directory here&gt;</FONT></STRONG> <BR>
<STRONG><FONT COLOR=MAROON>./mkd</FONT></STRONG>
  <LI>Check that the new library was used in the load module. <BR>
<STRONG><FONT COLOR=MAROON>ldd discord</FONT></STRONG> <BR>
It should look like <BR>
$ ldd discord <BR>
<P><PRE>        linux-gate.so.1 =&gt;  (0x00110000)
        libm.so.6 =&gt; /lib/libm.so.6 (0x00947000)
        libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x0098e000)
        libasound.so.2 =&gt; /usr/local/lib/alsa/libasound.so.2 (0x00111000)
        libncurses.so.5 =&gt; /lib/libncurses.so.5 (0x03c50000)
        libsndfile.so.1 =&gt; /usr/lib/libsndfile.so.1 (0x001d4000)
        libsamplerate.so.0 =&gt; /usr/lib/libsamplerate.so.0 (0x00234000)
        libc.so.6 =&gt; /lib/libc.so.6 (0x007f1000)
        /lib/ld-linux.so.2 (0x007d2000)
        libdl.so.2 =&gt; /lib/libdl.so.2 (0x00972000)
        libtinfo.so.5 =&gt; /lib/libtinfo.so.5 (0x03c36000)
 </PRE>
</OL>
<P>Make sure that libasound.so.2 points to /usr/local/lib/alsa as above.

<P>That's it, you're done.  Discord will now work properly.  When your package
manager updates your system to the next version of alsa-lib, you can remove
the file alsa.conf in ld.so.conf.d and run /sbin/ldconfig to enable the
package version.  Then recompile and test discord to see if it works with the
new version.  If it does, you can remove the link and library in
/usr/local/lib/alsa and forget about alsa-lib again.  If it doesn't, put the file
alsa.conf back into ld.so.conf.d, rerun /sbin/ldconfig, recompile discord
and you are back to operational status.
</BODY>
</HTML>
